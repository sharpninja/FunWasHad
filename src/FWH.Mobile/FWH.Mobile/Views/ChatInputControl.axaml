<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:FWH.Common.Chat.ViewModels;assembly=FWH.Common.Chat"
             xmlns:conv="clr-namespace:FWH.Mobile.ViewModels;assembly=FWH.Mobile"
             xmlns:controls="clr-namespace:FWH.Mobile.Views;assembly=FWH.Mobile"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="FWH.Mobile.ChatInputControl"
             x:DataType="local:ChatInputViewModel">
    <UserControl.Resources>
        <conv:ChatInputModeToTextVisibility x:Key="TextVisibility"/>
        <conv:ChatInputModeToChoiceVisibility x:Key="ChoiceVisibility"/>
        <conv:ChatInputModeToPhotoVisibility x:Key="PhotoVisibility"/>
    </UserControl.Resources>
    <Design.DataContext>
        <!-- Design-time removed to avoid needing parameterless ctor -->
        <x:Null />
    </Design.DataContext>
    <Panel Margin="0">
        <!-- Text Input Mode -->
        <Grid IsVisible="{Binding InputMode, Mode=OneWay, Converter={StaticResource TextVisibility}}"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Stretch"
              ColumnDefinitions="*,Auto"
              ColumnSpacing="8"
              Margin="8">
            <TextBox Grid.Column="0"
                     AcceptsReturn="True"
                     TextWrapping="Wrap"
                     Text="{Binding Text, Mode=TwoWay}"
                     HorizontalAlignment="Stretch"
                     VerticalAlignment="Stretch"/>
            <Button Grid.Column="1"
                    Command="{Binding SendCommand}"
                    ToolTip.Tip="Send">
                <TextBlock Text="âž¤" FontSize="18" />
            </Button>
        </Grid>

        <!-- Image/Camera Mode -->
        <Grid IsVisible="{Binding InputMode, Converter={StaticResource PhotoVisibility}}"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Stretch"
              RowDefinitions="*,Auto"
              RowSpacing="8"
              Margin="8">
            <Border Grid.Row="0"
                    Background="#F5F5F5"
                    BorderBrush="#E0E0E0"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="16">
                <StackPanel HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Spacing="12">
                    <TextBlock Text="ðŸ“·"
                               FontSize="48"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="Take a photo"
                               FontSize="16"
                               Foreground="#757575"
                               HorizontalAlignment="Center" />
                </StackPanel>
            </Border>
            <Button Grid.Row="1"
                    Command="{Binding OpenCameraCommand}"
                    HorizontalAlignment="Center"
                    Padding="24,12"
                    MinWidth="60"
                    MinHeight="60"
                    ToolTip.Tip="Open Camera">
                <TextBlock Text="ðŸ“·" FontSize="24" />
            </Button>
        </Grid>

        <!-- Choice Mode -->
        <Grid IsVisible="{Binding InputMode, Converter={StaticResource ChoiceVisibility}}"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Stretch"
              RowDefinitions="Auto,*"
              RowSpacing="8"
              Margin="8">
            <TextBlock Grid.Row="0"
                       Text="{Binding Choices.Prompt}"
                       TextWrapping="Wrap"
                       TextAlignment="Right"/>
            <ItemsControl Grid.Row="1"
                          ItemsSource="{Binding Choices.Choices}"
                          HorizontalAlignment="Right">
                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="local:ChoicesItem">
                        <Button Content="{Binding ChoiceText}"
                                Command="{Binding SelectChoiceCommand}"
                                CommandParameter="{Binding}"
                                Margin="0,4"/>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Grid>
    </Panel>
</UserControl>
